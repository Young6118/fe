<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>网络 | Young&#39;s blog</title>
    <meta name="generator" content="VuePress 1.5.3">
    <link rel="icon" href="/fe/logo.jpg">
    <meta name="description" content="周洋的个人网站">
    <link rel="preload" href="/fe/assets/css/0.styles.7ecbf534.css" as="style"><link rel="preload" href="/fe/assets/js/app.bcbb2bbf.js" as="script"><link rel="preload" href="/fe/assets/js/2.a136593f.js" as="script"><link rel="preload" href="/fe/assets/js/16.8bcaccd6.js" as="script"><link rel="prefetch" href="/fe/assets/js/10.21a553b4.js"><link rel="prefetch" href="/fe/assets/js/11.4fb39938.js"><link rel="prefetch" href="/fe/assets/js/12.598996ac.js"><link rel="prefetch" href="/fe/assets/js/13.3048c248.js"><link rel="prefetch" href="/fe/assets/js/14.4a9468d9.js"><link rel="prefetch" href="/fe/assets/js/15.aa584ddc.js"><link rel="prefetch" href="/fe/assets/js/17.61fcb09d.js"><link rel="prefetch" href="/fe/assets/js/18.83f3ba0b.js"><link rel="prefetch" href="/fe/assets/js/19.c2d62ee4.js"><link rel="prefetch" href="/fe/assets/js/3.989737ef.js"><link rel="prefetch" href="/fe/assets/js/4.e68864fd.js"><link rel="prefetch" href="/fe/assets/js/5.4b03a5f3.js"><link rel="prefetch" href="/fe/assets/js/6.476e112c.js"><link rel="prefetch" href="/fe/assets/js/7.47521b5d.js"><link rel="prefetch" href="/fe/assets/js/8.b3a6a03b.js"><link rel="prefetch" href="/fe/assets/js/9.e8edbf4d.js">
    <link rel="stylesheet" href="/fe/assets/css/0.styles.7ecbf534.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fe/" class="home-link router-link-active"><!----> <span class="site-name">Young's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/fe/fe/" class="nav-link router-link-active">
  前端基础
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/fe/fe/" class="nav-link router-link-active">
  前端基础
</a></div><div class="nav-item"><a href="https://baidu.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/fe/fe/vue.html" class="sidebar-link">Vue</a></li><li><a href="/fe/fe/vue-router.html" class="sidebar-link">vue-router</a></li><li><a href="/fe/fe/JS.html" class="sidebar-link">JavaScript</a></li><li><a href="/fe/fe/设计模式.html" class="sidebar-link">设计模式</a></li><li><a href="/fe/fe/函数.html" class="sidebar-link">函数</a></li><li><a href="/fe/fe/html+css.html" class="sidebar-link">HTML+CSS</a></li><li><a href="/fe/fe/面经.html" class="sidebar-link">面经</a></li><li><a href="/fe/fe/算法.html" class="sidebar-link">算法</a></li><li><a href="/fe/fe/网络安全.html" class="sidebar-link">网络安全</a></li><li><a href="/fe/fe/前端工程化.html" class="sidebar-link">前端工程化</a></li><li><a href="/fe/fe/网络.html" class="active sidebar-link">网络</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fe/fe/网络.html#跨域" class="sidebar-link">跨域</a></li><li class="sidebar-sub-header"><a href="/fe/fe/网络.html#简单请求" class="sidebar-link">简单请求</a></li><li class="sidebar-sub-header"><a href="/fe/fe/网络.html#说一下http-是什么" class="sidebar-link">说一下http 是什么</a></li><li class="sidebar-sub-header"><a href="/fe/fe/网络.html#http-缓存策略-强缓存与协商缓存" class="sidebar-link">http 缓存策略 强缓存与协商缓存</a></li></ul></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="网络"><a href="#网络" class="header-anchor">#</a> 网络</h1> <h2 id="跨域"><a href="#跨域" class="header-anchor">#</a> 跨域</h2> <p>同源条件：协议、域名、端口相同</p> <p>同源策略限制以下几种行为：</p> <ul><li>Cookie、LocalStorage 和 IndexDB 无法读取</li> <li>DOM和JS对象无法获得</li> <li>AJAX 请求不能发送</li></ul> <p>对于端口、协议的不同，只能后端解决。我们解决域名不同的情况：</p> <p>1.jsonp（只支持get请求，支持老的IE浏览器）适合加载不同域名的js、css，img等静态资源；</p> <blockquote><p>jsonp的原理就是利用<code>&lt;script&gt;</code>标签没有跨域限制，通过<code>&lt;script</code>&gt;标签src属性，发送带有callback参数的GET请求，服务端将接口返回数据拼凑到callback函数中，返回给浏览器，浏览器解析执行，从而前端拿到callback函数返回的数据。</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 原生JS实现：</span>

    <span class="token keyword">var</span> script <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'script'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    script<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token string">'text/javascript'</span><span class="token punctuation">;</span>

    <span class="token comment">// 传参一个回调函数名给后端，方便后端返回时执行这个在前端定义的回调函数</span>
    script<span class="token punctuation">.</span>src <span class="token operator">=</span> <span class="token string">'http://www.domain2.com:8080/login?user=admin&amp;callback=handleCallback'</span><span class="token punctuation">;</span>
    document<span class="token punctuation">.</span>head<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>script<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 回调执行函数</span>
    <span class="token keyword">function</span> <span class="token function">handleCallback</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token comment">// 服务端返回如下（返回时即执行全局函数）：</span>

<span class="token function">handleCallback</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&quot;user&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>2.CORS（支持所有类型的HTTP请求，但浏览器IE10以下不支持）适合做ajax各种跨域请求；</p> <blockquote><p>服务端：设置响应头<code>Access-Control-Allow-Origin： *</code>，允许任意域向服务提交请求
前端设置 xhr.withCredentials = true;</p></blockquote> <p>3.Nginx代理跨域和nodejs中间件跨域原理都相似，都是搭建一个服务器，直接在服务器端请求HTTP接口，这适合前后端分离的前端项目调后端接口。</p> <blockquote><p>nginx代理跨域，实质和CORS跨域原理一样，通过配置文件设置请求响应头Access-Control-Allow-Origin…等字段。</p></blockquote> <p>4.document.domain+iframe 适合主域名相同，子域名不同的跨域请求。</p> <p>5.postMessage、websocket 都是HTML5新特性，兼容性不是很好，只适用于主流浏览器和IE10+。</p> <p>CORS是一个W3C标准，全称是&quot;跨域资源共享&quot;（Cross-origin resource sharing）。
它允许浏览器向跨源服务器，发出XMLHttpRequest请求，从而克服了AJAX只能同源使用的限制。
CORS需要浏览器和服务器同时支持。目前，所有浏览器都支持该功能，IE浏览器不能低于IE10。</p> <p>浏览器将CORS跨域请求分为简单请求和非简单请求。</p> <h2 id="简单请求"><a href="#简单请求" class="header-anchor">#</a> 简单请求</h2> <p>只要同时满足以下两个条件，就属于简单请求</p> <p>(1)使用下列方法之一：</p> <ul><li>head</li> <li>get</li> <li>post</li></ul> <p>(2)请求的Heder是</p> <ul><li>Accept</li> <li>Accept-Language</li> <li>Content-Language</li> <li>Content-Type: 只限于三个值：application/x-www-form-urlencoded、multipart/form-data、text/plain</li></ul> <p>不同时满足上面的两个条件，就属于非简单请求。浏览器对这两种的处理，是不一样的。</p> <p>对于简单请求，浏览器直接发出CORS请求。具体来说，就是在头信息之中，增加一个Origin字段。</p> <div class="language-bash extra-class"><pre class="language-bash"><code>GET /cors HTTP/1.1
Origin: http://api.bob.com
Host: api.alice.com
Accept-Language: en-US
Connection: keep-alive
User-Agent: Mozilla/5.0<span class="token punctuation">..</span>.
</code></pre></div><p>上面的头信息中，Origin字段用来说明，本次请求来自哪个源（协议 + 域名 + 端口）。服务器根据这个值，决定是否同意这次请求。</p> <p>CORS请求设置的响应头字段，都以 Access-Control-开头:</p> <p>1）Access-Control-Allow-Origin：必选</p> <p>它的值要么是请求时Origin字段的值，要么是一个*，表示接受任意域名的请求。</p> <p>2）Access-Control-Allow-Credentials：可选</p> <p>它的值是一个布尔值，表示是否允许发送Cookie。默认情况下，Cookie不包括在CORS请求之中。设为true，即表示服务器明确许可，Cookie可以包含在请求中，一起发给服务器。这个值也只能设为true，如果服务器不要浏览器发送Cookie，删除该字段即可。</p> <p>3）Access-Control-Expose-Headers：可选</p> <p>CORS请求时，XMLHttpRequest对象的getResponseHeader()方法只能拿到6个基本字段：Cache-Control、Content-Language、Content-Type、Expires、Last-Modified、Pragma。如果想拿到其他字段，就必须在Access-Control-Expose-Headers里面指定。上面的例子指定，getResponseHeader(‘FooBar’)可以返回FooBar字段的值。</p> <p>非简单请求</p> <p>非简单请求是那种对服务器有特殊要求的请求，比如请求方法是PUT或DELETE，或者Content-Type字段的类型是application/json。非简单请求的CORS请求，会在正式通信之前，增加一次HTTP查询请求，称为&quot;预检&quot;请求（preflight）。</p> <p>预检请求</p> <p>预检&quot;请求用的请求方法是OPTIONS，表示这个请求是用来询问的。请求头信息里面，关键字段是Origin，表示请求来自哪个源。除了Origin字段，&quot;预检&quot;请求的头信息包括两个特殊字段。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token constant">OPTIONS</span> <span class="token operator">/</span>cors <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>
Origin<span class="token operator">:</span> http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>api<span class="token punctuation">.</span>bob<span class="token punctuation">.</span>com
Access<span class="token operator">-</span>Control<span class="token operator">-</span>Request<span class="token operator">-</span>Method<span class="token operator">:</span> <span class="token constant">PUT</span>
Access<span class="token operator">-</span>Control<span class="token operator">-</span>Request<span class="token operator">-</span>Headers<span class="token operator">:</span> <span class="token constant">X</span><span class="token operator">-</span>Custom<span class="token operator">-</span>Header
Host<span class="token operator">:</span> api<span class="token punctuation">.</span>alice<span class="token punctuation">.</span>com
Accept<span class="token operator">-</span>Language<span class="token operator">:</span> en<span class="token operator">-</span><span class="token constant">US</span>
Connection<span class="token operator">:</span> keep<span class="token operator">-</span>alive
User<span class="token operator">-</span>Agent<span class="token operator">:</span> Mozilla<span class="token operator">/</span><span class="token number">5.0</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre></div><p>1）Access-Control-Request-Method：必选</p> <p>用来列出浏览器的CORS请求会用到哪些HTTP方法，上例是PUT。</p> <p>2）Access-Control-Request-Headers：可选</p> <p>该字段是一个逗号分隔的字符串，指定浏览器CORS请求会额外发送的头信息字段，上例是X-Custom-Header。</p> <p>预检请求的回应</p> <p>服务器收到&quot;预检&quot;请求以后，检查了Origin、Access-Control-Request-Method和Access-Control-Request-Headers字段以后，确认允许跨源请求，就可以做出回应。</p> <p>HTTP回应中，除了关键的是Access-Control-Allow-Origin字段，其他CORS相关字段如下：</p> <p>1）Access-Control-Allow-Methods：必选</p> <p>它的值是逗号分隔的一个字符串，表明服务器支持的所有跨域请求的方法。注意，返回的是所有支持的方法，而不单是浏览器请求的那个方法。这是为了避免多次&quot;预检&quot;请求。</p> <p>2）Access-Control-Allow-Headers</p> <p>如果浏览器请求包括Access-Control-Request-Headers字段，则Access-Control-Allow-Headers字段是必需的。它也是一个逗号分隔的字符串，表明服务器支持的所有头信息字段，不限于浏览器在&quot;预检&quot;中请求的字段。</p> <p>3）Access-Control-Allow-Credentials：可选</p> <p>该字段与简单请求时的含义相同。</p> <p>4）Access-Control-Max-Age：可选</p> <p>用来指定本次预检请求的有效期，单位为秒。</p> <h2 id="说一下http-是什么"><a href="#说一下http-是什么" class="header-anchor">#</a> 说一下http 是什么</h2> <p>超文本传输协议，使用计算机能够理解的语言确立了计算机之间通信的规范，用于两节点之间传输文字、图片、音频、视频等超文本数据信息的约定和规范。</p> <p>状态码 200和304是什么，有什么区别</p> <h2 id="http-缓存策略-强缓存与协商缓存"><a href="#http-缓存策略-强缓存与协商缓存" class="header-anchor">#</a> http 缓存策略 强缓存与协商缓存</h2> <h3 id="无缓存-200-size-1mb-time-500ms"><a href="#无缓存-200-size-1mb-time-500ms" class="header-anchor">#</a> 无缓存 <code>200 (size: 1mb, time: 500ms)</code></h3> <p><code>cache-control: no-store</code></p> <h3 id="协商缓存：需要与服务端发生交互，判断是否使用本地缓存的文件。304-size-350b-time-100ms"><a href="#协商缓存：需要与服务端发生交互，判断是否使用本地缓存的文件。304-size-350b-time-100ms" class="header-anchor">#</a> 协商缓存：需要与服务端发生交互，判断是否使用本地缓存的文件。<code>304 (size: 350b, time: 100ms)</code></h3> <p>304请求判断是否使用本地缓存，缓存命中使用本地缓存</p> <p><code>cache-control: no-cache</code>跳过设置强缓存，但是不妨碍设置协商缓存；一般如果你做了强缓存，只有在强缓存失效了才走协商缓存的，设置了no-cache就不会走强缓存了，每次请求都回询问服务端。</p> <p>响应头设置</p> <div class="language- extra-class"><pre class="language-text"><code>ETag
Last-Modified
</code></pre></div><p>步骤总结：
1.请求资源时，把用户本地该资源的 etag 同时带到服务端，服务端和最新资源做对比。
2.如果资源没更改，返回304，浏览器读取本地缓存。
3.如果资源有更改，返回200，返回最新的资源。</p> <h3 id="强缓存：无需与服务端发生交互200-size-from-memory-cache-time-0ms"><a href="#强缓存：无需与服务端发生交互200-size-from-memory-cache-time-0ms" class="header-anchor">#</a> 强缓存：无需与服务端发生交互<code>200 (size:from memory cache, time: 0ms)</code></h3> <p>有 max-age 设置强缓存</p> <div class="language- extra-class"><pre class="language-text"><code>Expires 过期时间
Cache-Control: public/max-age=1111111/no-cache
</code></pre></div><p>最佳实践：</p> <p>index.html文件采用协商缓存，理由就是要用户每次请求index.html不拿浏览器缓存，直接请求服务器，这样就保证资源更新了，用户能马上访问到新资源，如果服务端返回304，这时候再拿浏览器的缓存的index.html，切记不要设置强缓存！！！</p> <p>其他资源采用强缓存 + 协商缓存,理由就不多说了。</p> <p>如果有一个网页访问是 200 fom cached
刷新后是什么结果</p> <p>max-age范围内，即使用户做了刷新操作，也不向服务器发起http请求</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020-8-24 19:53:27</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fe/fe/前端工程化.html" class="prev">
        前端工程化
      </a></span> <!----></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/fe/assets/js/app.bcbb2bbf.js" defer></script><script src="/fe/assets/js/2.a136593f.js" defer></script><script src="/fe/assets/js/16.8bcaccd6.js" defer></script>
  </body>
</html>
